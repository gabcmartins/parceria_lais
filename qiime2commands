qiime tools import --type 'SampleData[PairedEndSequencesWithQuality]' --input-path manifest.tsv --output-path out_qiime.qza  --input-format PairedEndFastqManifestPhred33V2

qiime dada2 denoise-single --i-demultiplexed-seqs out_qiime.qza --p-trim-left 0 --p-trunc-len 210 --o-representative-sequences rep-seqs-dada2.qza --o-table table-dada2.qza --o-denoising-stats stats-dada2.qza

qiime metadata tabulate --m-input-file stats-dada2.qza --o-visualization stats-dada2.qzv

mv rep-seqs-dada2.qza rep-seqs.qza; mv table-dada2.qza table.qza

qiime feature-table summarize --i-table table.qza --o-visualization table.qzv --m-sample-metadata-file metadata.tsv

qiime feature-table tabulate-seqs --i-data rep-seqs.qza --o-visualization rep-seqs.qzv

qiime phylogeny align-to-tree-mafft-fasttree --i-sequences rep-seqs.qza --o-alignment aligned-rep-seqs.qza --o-masked-alignment masked-aligned-rep-seqs.qza --o-tree unrooted-tree.qza --o-rooted-tree rooted-tree.qza

qiime diversity core-metrics-phylogenetic --i-phylogeny rooted-tree.qza --i-table table.qza --p-sampling-depth 90460 --m-metadata-file metadata.tsv --output-dir core-metrics-results

qiime diversity alpha-group-significance --i-alpha-diversity core-metrics-results/faith_pd_vector.qza --m-metadata-file metadata.tsv --o-visualization core-metrics-results/faith-pd-group-significance.qzv

qiime diversity alpha-group-significance --i-alpha-diversity core-metrics-results/evenness_vector.qza --m-metadata-file metadata.tsv --o-visualization core-metrics-results/evenness-group-significance.qzv

qiime diversity beta-group-significance --i-distance-matrix core-metrics-results/unweighted_unifrac_distance_matrix.qza --m-metadata-file metadata.tsv --m-metadata-column group --o-visualization core-metrics-results/unweighted-unifrac-group-significance.qzv --p-pairwise

qiime diversity alpha-rarefaction --i-table table.qza --i-phylogeny rooted-tree.qza --p-max-depth 4000 --o-visualization alpha-rarefaction.qzv

qiime feature-classifier classify-sklearn --i-classifier silva-138-99-nb-classifier.qza --i-reads rep-seqs.qza --o-classification taxonomy.qza

qiime metadata tabulate --m-input-file ls --o-visualization taxonomy.qzv

qiime feature-table group   --i-table table.qza   --m-metadata-file metadata.tsv   --m-metadata-column group --p-axis sample  --p-mode sum   --o-grouped-table table-grouped.qza     #grouped table to generate grouped taxa bar plot

qiime taxa barplot   --i-table table-grouped.qza   --i-taxonomy taxonomy.qza   --m-metadata-file new-metadata.tsv   --o-visualization taxa-barplot-grouped.qzv     #grouá¹•ed taxa barplot 
#new-metadata file should contain: 
#SampleID       group
Controle        Controle
Knockout-IL1a   Knockout-IL1a
Knockout-IL1aR  Knockout-IL1aR

qiime taxa barplot --i-table table.qza --i-taxonomy taxonomy.qza --m-metadata-file metadata.tsv --o-visualization taxa-bar-plots.qzv

qiime composition ancombc --i-table table.qza --m-metadata-file metadata.tsv --p-formula 'group' --o-differentials ancombc-group.qza

qiime composition da-barplot --i-data ancombc-group.qza --p-significance-threshold 0.001 --o-visualization da-barplot-group.qzv

qiime taxa collapse --i-table table.qza --i-taxonomy taxonomy.qza --p-level 5 --o-collapsed-table table-l5.qza

qiime composition ancombc --i-table table-l5.qza --m-metadata-file metadata.tsv --p-formula 'group' --o-differentials l5-ancombc-group.qza

qiime composition da-barplot --i-data l5-ancombc-group.qza --p-significance-threshold 0.001 --p-level-delimiter ';' --o-visualization l5-da-barplot-group.qzv


##### Extracting tables

qiime tools export --input-path BacteriaFamily_freqtable_ordination.qza --output-path ordination_HMP_BacteriaFamily_output


##### Creating a classifier

qiime tools import --type 'FeatureData[Sequence]' --input-path gg_13_8_otus/rep_set/99_otus.fasta --output-path 99_otus.qza

qiime tools import --type 'FeatureData[Taxonomy]' --input-format HeaderlessTSVTaxonomyFormat --input-path gg_13_8_otus/taxonomy/99_otu_taxonomy.txt --output-path ref-taxonomy.qza

qiime feature-classifier extract-reads --i-sequences 99_otus.qza --p-f-primer CCTACGGRRBGCASCAGKVRVGAAT --p-r-primer GGACTACNVGGGTWTCTAATC --o-reads ref-seqs.qza

qiime feature-classifier fit-classifier-naive-bayes --i-reference-reads ref-seqs.qza --i-reference-taxonomy ref-taxonomy.qza --o-classifier classifier_V3V4_99otus.qza
